---
title: "NFL EPA Analysis – Data Wrangling & Exploratory Modeling"
format: gfm
execute: 
  warning: false
  message: false
  errors: false
jupyter: python3
---

## This project explores how different play characteristics in the NFL relate to Expected Points Added (EPA). Using publicly available 2024 play-by-play data, the analysis investigates whether "riskier" plays—such as deep passes or specific scramble directions—are associated with higher EPA.

- Data loading and basic wrangling  
- Text-based feature creation from play descriptions  
- Simple statistical modeling (OLS and logistic regression)  
- Exploratory visualizations  
- Player-level breakdowns for Lamar Jackson and Josh Allen 

### Data

The primary dataset is a 2024 NFL play-by-play file:

- `nfl_pbp_2024_full.csv`

It includes play descriptions, EPA, air yards, and other play-level information.

```{python}
#| label: load-data
#| echo: true
#| message: false

import pandas as pd
import statsmodels.api as sm
import seaborn as sns
import matplotlib.pyplot as plt

pbp = pd.read_csv('c:/Users/asaar/Downloads/Machine Learning/nfl_pbp_2024.csv')

pbp.head()
```

### Methods
Initial Exploration: Air Yards and EPA

We first examine whether air yards (a proxy for "riskier" throws) are associated with EPA.

```{python}
#| label: fig-air-yards-epa
#| fig-cap: "Relationship between air yards and EPA for all 2024 plays."
#| echo: false

sns.scatterplot(data=pbp, x="air_yards", y="epa")
plt.title("Do Air Yards Predict EPA?")
plt.ylabel("EPA")
plt.xlabel("Air Yards")
plt.tight_layout()
plt.show()

```

We fit a simple OLS model with air yards as the outcome and EPA as the predictor to quantify the relationship.

```{python}
#| label: model-air-yards
#| echo: true

risky_ols = sm.formula.ols("air_yards ~ epa", data=pbp).fit()
risky_ols.summary()

```

Interpretation (summary): The fitted model suggests there is little to no meaningful linear relationship between EPA and air yards league-wide.

### Text-Based Features: Deep vs Short Passes

We construct indicators for pass depth using the natural language in the play description field.

```{python}
#| label: deep-short-features
#| echo: true

pbp["desc_lower"] = pbp["desc"].str.lower()

pbp["pass_deep_all"] = pbp["desc_lower"].str.contains("pass deep")
pbp["pass_short_all"] = pbp["desc_lower"].str.contains("pass short")

pbp[["desc_lower", "pass_deep_all", "pass_short_all"]].head()

```

To understand whether higher EPA is associated with plays that are labeled "deep," we fit a logistic regression:

```{python}
#| label: deep-logit
#| echo: true

pbp["deep_yes"] = pbp["pass_deep_all"].astype(int)

deep_logit = sm.formula.logit("deep_yes ~ epa", data=pbp).fit()
deep_logit.summary()


```

We can also compare the mean EPA of deep vs short passes:

```{python}
#| label: pass-depth-epa
#| echo: true

pbp_pass_depth = pbp[(pbp["pass_deep_all"]) | (pbp["pass_short_all"])].copy()

pass_depth_results_all = {
"Deep Pass": pbp_pass_depth.loc[pbp_pass_depth["pass_deep_all"], "epa"].mean(),
"Short Pass": pbp_pass_depth.loc[pbp_pass_depth["pass_short_all"], "epa"].mean(),
}

pass_depth_df_all = (
pd.DataFrame.from_dict(pass_depth_results_all, orient="index", columns=["mean_epa"])
.rename_axis("pass_type")
.reset_index()
)

pass_depth_df_all

#| label: fig-pass-depth-epa
#| fig-cap: "League-wide mean EPA for deep vs short passes."
#| echo: false

plt.figure()
plt.bar(pass_depth_df_all["pass_type"], pass_depth_df_all["mean_epa"])
plt.title("League-wide – Mean EPA: Deep Pass vs Short Pass (2024)")
plt.ylabel("Mean EPA")
plt.xlabel("Pass Depth Type")
plt.axhline(0, color="black", linewidth=1)
plt.tight_layout()
plt.show()

```

### Scramble Direction – League-Wide

We classify scramble direction using three patterns in the play descriptions:

"scrambles left"

"scrambles right"

"scrambles up the middle"

```{python}
#| label: scramble-direction-features
#| echo: true

pbp["scramble_left_all"] = pbp["desc_lower"].str.contains("scrambles left")
pbp["scramble_right_all"] = pbp["desc_lower"].str.contains("scrambles right")
pbp["scramble_middle_all"] = pbp["desc_lower"].str.contains("scrambles up the middle")

pbp_scrambles = pbp[pbp["desc_lower"].str.contains("scrambles")].copy()

scramble_results_all = {
"left": pbp_scrambles.loc[pbp_scrambles["scramble_left_all"], "epa"].mean(),
"right": pbp_scrambles.loc[pbp_scrambles["scramble_right_all"], "epa"].mean(),
"middle": pbp_scrambles.loc[pbp_scrambles["scramble_middle_all"], "epa"].mean(),
}

scramble_df_all = (
pd.DataFrame.from_dict(scramble_results_all, orient="index", columns=["mean_epa"])
.rename_axis("scramble_direction")
.reset_index()
)

scramble_df_all

#| label: fig-scramble-league
#| fig-cap: "League-wide mean EPA by scramble direction (2024)."
#| echo: false

plt.figure()
plt.bar(scramble_df_all["scramble_direction"], scramble_df_all["mean_epa"])
plt.title("League-wide – EPA by Scramble Direction (2024)")
plt.ylabel("Mean EPA")
plt.xlabel("Scramble Direction")
plt.axhline(0, color="black", linewidth=1)
plt.tight_layout()
plt.show()

```

### Player-Level Analysis

In the second half of the project, we focus on two quarterbacks: Lamar Jackson and Josh Allen. For each quarterback, we:

Filter the play-by-play data using a name identifier in desc_lower

Build scramble direction flags

Build deep vs short pass indicators

Compute mean EPA for each category and visualize the results

Below is a representative example for one quarterback (Lamar Jackson); the code for Josh Allen follows the same structure in the main script.

```{python}
#| label: lamar-filter
#| echo: true

lamar = pbp[pbp["desc_lower"].str.contains("l.jackson")].copy()

lamar["scramble_left"] = lamar["desc_lower"].str.contains("scrambles left")
lamar["scramble_right"] = lamar["desc_lower"].str.contains("scrambles right")
lamar["scramble_middle"] = lamar["desc_lower"].str.contains("scrambles up the middle")

lamar_scrambles = lamar[lamar["desc_lower"].str.contains("scrambles")].copy()

results_lamar_scramble = {
"left": lamar_scrambles.loc[lamar_scrambles["scramble_left"], "epa"].mean(),
"right": lamar_scrambles.loc[lamar_scrambles["scramble_right"], "epa"].mean(),
"middle": lamar_scrambles.loc[lamar_scrambles["scramble_middle"], "epa"].mean(),
}

results_lamar_scramble

#| label: fig-lamar-scramble
#| fig-cap: "Lamar Jackson – mean EPA by scramble direction (2024)."
#| echo: false

lamar_scramble_df = (
pd.DataFrame.from_dict(results_lamar_scramble, orient="index", columns=["mean_epa"])
.rename_axis("scramble_direction")
.reset_index()
)

plt.figure()
plt.bar(lamar_scramble_df["scramble_direction"], lamar_scramble_df["mean_epa"])
plt.title("Lamar Jackson – EPA by Scramble Direction (2024)")
plt.ylabel("Mean EPA")
plt.xlabel("Scramble Direction")
plt.axhline(0, color="black", linewidth=1)
plt.tight_layout()
plt.show()

```

A similar workflow is applied for deep vs short passes and replicated for Josh Allen in the .py script.


### Discussion

Overall, the analysis suggests:

Air yards alone are not strongly predictive of EPA, despite being an intuitive proxy for risk.

Deep passes tend to be associated with higher EPA compared to short passes when classified using play descriptions.

Scramble direction matters for both league-wide plays and specific quarterbacks, with certain directions yielding higher average EPA.

Player-level breakdowns (Lamar Jackson vs Josh Allen) highlight stylistic differences and can inform both scouting and strategic decision-making.
